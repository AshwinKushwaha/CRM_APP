@model IEnumerable<CRMApp.Models.Customer>

@{
	ViewData["Title"] = "Index";
	Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2 class="text-center">Customer List</h2>
@if (User.IsInRole("admin") || User.IsInRole("salesrep"))
{
	<p>
		<a asp-action="Create" class="btn btn-success">Create New</a>
	</p>
}

<div class="d-flex justify-content-center">
	<form asp-action="Index" style="width: 100%;">
		<div class="d-flex gap-1">
			<input class="form-control" type="text" placeholder="Search bar" name="input"/>
			<button type="submit" class="btn btn-outline-primary">Search</button>
		</div>
	</form> 
</div>


<br />


@{
	if (ViewBag.Count == 0)
	{
		<p class="text-center">No Customer Found</p>
	}
	else
	{
		<table class="table table-hover table-bordered table-striped table-dark">
			<thead>
				<tr>
					<th>
						@Html.DisplayNameFor(model => model.Name)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.Email)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.Phone)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.CreatedAt)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.UpdatedAt)
					</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in Model)
				{
					<tr>
						<td>
							@Html.DisplayFor(modelItem => item.Name)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.Email)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.Phone)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.CreatedAt)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.UpdatedAt)
						</td>
						<td>
							@if (User.IsInRole("admin") || User.IsInRole("salesrep"))
							{
								<a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-outline-success">Edit</a>
							}

							<a asp-action="Details" asp-route-id="@item.Id" class="btn btn-outline-primary">Details</a>
							@if (User.IsInRole("admin"))
							{
								<a data-bs-toggle="modal" data-bs-target="#confirmDeleteModal-@item.Id" class="btn btn-outline-danger">Delete</a>
							}

						</td>
					</tr>
				}
			</tbody>
		</table>
	}
}
@foreach (var item in Model)
{
	<div class="modal fade" id="confirmDeleteModal-@item.Id" tabindex="-1" aria-labelledby="deleteModalLabel-@item.Id" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form asp-action="Delete" asp-controller="Customer" method="post">
					<input type="hidden" name="id" value="@item.Id" />
					<div class="modal-header">
						<h5 class="modal-title" id="deleteModalLabel-@item.Id">Confirm Delete</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						Are you sure you want to delete <strong>@item.Name</strong>?
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-danger">Delete</button>
					</div>
				</form>
			</div>
		</div>
	</div>
}


