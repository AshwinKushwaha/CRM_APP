@model CRMApp.ViewModels.CustomerViewModel

@{
	ViewData["Title"] = "Details";
	Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div>
	<h1 class="text-center">Customer Details</h1>
	<hr />
	<dl class="row">
		<dt class="col-sm-2">
			@Html.DisplayNameFor(model => model.Customer.Name)
		</dt>
		<dd class="col-sm-10">
			@Html.DisplayFor(model => model.Customer.Name)
		</dd>
		<dt class="col-sm-2">
			@Html.DisplayNameFor(model => model.Customer.Email)
		</dt>
		<dd class="col-sm-10">
			@Html.DisplayFor(model => model.Customer.Email)
		</dd>
		<dt class="col-sm-2">
			@Html.DisplayNameFor(model => model.Customer.Phone)
		</dt>
		<dd class="col-sm-10">
			@Html.DisplayFor(model => model.Customer.Phone)
		</dd>
		<dt class="col-sm-2">
			@Html.DisplayNameFor(model => model.Customer.CreatedAt)
		</dt>
		<dd class="col-sm-10">
			@Html.DisplayFor(model => model.Customer.CreatedAt)
		</dd>
		<dt class="col-sm-2">
			@Html.DisplayNameFor(model => model.Customer.UpdatedAt)
		</dt>
		<dd class="col-sm-10">
			@Html.DisplayFor(model => model.Customer.UpdatedAt)
		</dd>
	</dl>
</div>
@* <div>
    <a asp-action="Edit" asp-route-id="@Model?.Customer.Id" class="btn btn-primary">Edit</a>
    @* <a asp-action="Index">Back to List</a>
</div> *@
<h1 class="text-center">Contact Details</h1>
<hr />
<div class="card">

	<div class="text-end me-3 mt-3">
		<a data-bs-toggle="modal" data-bs-target="#createModal" class="btn btn-success">Add New Contact</a>
	</div>
	<div class="d-flex justify-content-center">
		<table class="table table-hover table-bordered table-striped mt-4" style="width:85%;">
			<thead>
				<tr>

					<th>
						@Html.DisplayNameFor(model => model.CustomerContact.CustName)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.CustomerContact.Relation)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.CustomerContact.ContactType)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.CustomerContact.Contact)
					</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in Model.Contacts)
				{
					<tr>
						<td>
							@Html.DisplayFor(modelItem => item.CustName)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.Relation)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.ContactType)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.Contact)
						</td>

						<td>
							<div class="d-flex justify-content-center">
								@if (User.IsInRole("admin") || User.IsInRole("salesrep"))
								{
									<a data-bs-toggle="modal" data-bs-target="#EditModal-@item.Id" class="btn btn-outline-success" >Edit</a>
								}

								@if (User.IsInRole("admin"))
								{
									<a data-bs-toggle="modal" data-bs-target="#confirmDeleteModal-@item.Id" class="btn btn-outline-danger">Delete</a>
								}
							</div>

							@*

						<a asp-action="Details" asp-route-id="@item.Id" class="btn btn-outline-primary">Details</a> *@
							@* @if (User.IsInRole("admin"))
						{

						} *@

						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</div>
<br />
<h1 class="text-center">Notes</h1>
<hr />
<div class="d-flex justify-content-around">
	<div class="card">
	</div>

</div>

<div class="modal fade" id="createModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<partial name="_ContactForm" model="new CRMApp.ViewModels.CustomerViewModel{CustomerContact = new CustomerContact{Id =0 , CustomerId = Model.Customer.Id}}" />
		</div>
	</div>
</div>

@foreach (var item in Model.Contacts)
{
	<div class="modal fade" id="EditModal-@item.Id" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<partial name="_ContactForm" model="new CRMApp.ViewModels.CustomerViewModel{
							CustomerContact = new CustomerContact {
								Id = item.Id,
								CustomerId = item.CustomerId,
								Contact = item.Contact,
								CustName = item.CustName,
								ContactType = item.ContactType,
								Relation = item.Relation
							}
				}" />
			</div>
		</div>
	</div>
}

@foreach (var item in Model.Contacts)
{
	<div class="modal fade" id="confirmDeleteModal-@item.Id" tabindex="-1" aria-labelledby="deleteModalLabel-@item.Id" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form asp-action="DeleteContact" asp-controller="Contact" method="post">
					<input type="hidden" name="id" value="@item.Id" />
					<div class="modal-header">
						<h5 class="modal-title" id="deleteModalLabel-@item.Id">Confirm Delete</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						Are you sure you want to delete <strong>@item.CustName</strong>?
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-danger">Delete</button>
					</div>
				</form>
			</div>
		</div>
	</div>
}
@section Scripts {

	<script>
		$(document).ready(function () {
			$("#btnSave").click(function (e) {
				debugger;
				e.preventDefault();
				debugger;
				var form = $("#frmContact");
				if (form.valid()) {
					form.submit();
				}

			})
		});
	</script>
}
